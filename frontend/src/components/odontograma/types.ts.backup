export interface InterventionImage {
  filename: string;
  data: string;
  contentType: string;
  uploadDate: string;
  description: string;
}

export interface Intervention {
  id: string;
  date: string;
  toothNumber: number;
  procedure: string;
  notes: string;
  status: 'completado' | 'pendiente' | 'cancelado';
  part?: 'todo' | 'superior' | 'inferior' | 'izquierda' | 'derecha' | 'centro';
  type?: string;
  images?: InterventionImage[];
}

export interface Tooth {
  id: string;
  number: number;
  condition: string;
  notes: string;
  interventions: Intervention[];
  type?: 'incisivo' | 'canino' | 'premolar' | 'molar';
  posX?: number;
  posY?: number;
  rotation?: number;
  size?: { width: number; height: number };
  cuadrante?: 'superior-derecho' | 'superior-izquierdo' | 'inferior-derecho' | 'inferior-izquierdo';
  tipoDentadura?: 'permanente' | 'temporal';
}

export interface OdontogramaProps {
  patientId: string;
}

// Configuración completa de todos los dientes (permanentes y temporales)
export const TODOS_LOS_DIENTES = [
  // -----------------------------------------
  // CUADRANTES PERMANENTES
  // -----------------------------------------

  // Dientes adicionales (1-10) - Posiciones intermedias
  { id: 1, posX: 50, posY: 50, tipo: 'molar', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 2, posX: 80, posY: 60, tipo: 'molar', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 3, posX: 110, posY: 70, tipo: 'molar', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 4, posX: 140, posY: 80, tipo: 'premolar', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 5, posX: 170, posY: 90, tipo: 'premolar', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 6, posX: 200, posY: 100, tipo: 'canino', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 7, posX: 230, posY: 110, tipo: 'incisivo', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 8, posX: 260, posY: 120, tipo: 'incisivo', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 9, posX: 290, posY: 130, tipo: 'incisivo', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 10, posX: 320, posY: 140, tipo: 'incisivo', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },

  // Cuadrante Superior Izquierdo (21–28) - lado derecho (posX más alto) - Mejor espaciado
  { id: 21, posX: 420, posY: 30, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 22, posX: 470, posY: 40, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 23, posX: 520, posY: 55, tipo: 'canino',    tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 24, posX: 570, posY: 75, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 25, posX: 620, posY: 100, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 26, posX: 670, posY: 130, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 27, posX: 720, posY: 165, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 28, posX: 760, posY: 200, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },

  // Dientes adicionales (29-30) - Posiciones intermedias
  { id: 29, posX: 800, posY: 220, tipo: 'molar', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 30, posX: 830, posY: 240, tipo: 'molar', tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },

  // Cuadrante Superior Derecho (11-18) - Mejor espaciado
  { id: 18, posX: 100,  posY: 200, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 17, posX: 140, posY: 165, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 16, posX: 180, posY: 130, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 15, posX: 230, posY: 100, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 14, posX: 280, posY: 75, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 13, posX: 330, posY: 55, tipo: 'canino',    tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 12, posX: 370, posY: 40, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 11, posX: 410, posY: 30, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },

  // Cuadrante Inferior Izquierdo (31-38) - lado derecho - Perfectamente simétrico
  { id: 31, posX: 450, posY: 520, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 32, posX: 500, posY: 510, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 33, posX: 550, posY: 490, tipo: 'canino',    tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 34, posX: 600, posY: 475, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 35, posX: 650, posY: 455, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 36, posX: 700, posY: 420, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 37, posX: 750, posY: 390, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 38, posX: 800, posY: 330, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },

  // Cuadrante Inferior Derecho (41-48) - lado izquierdo - Espaciado más compacto
  { id: 41, posX: 350, posY: 520, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 42, posX: 310, posY: 510, tipo: 'incisivo',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 43, posX: 270, posY: 490, tipo: 'canino',    tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 44, posX: 230, posY: 475, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 45, posX: 190, posY: 455, tipo: 'premolar',  tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 46, posX: 150, posY: 420, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 47, posX: 110, posY: 390, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },
  { id: 48, posX: 70,  posY: 330, tipo: 'molar',     tipoDentadura: 'permanente', estado: {}, intervenciones: [], historial: [] },

  // -----------------------------------------
  // CUADRANTES TEMPORALES
  // -----------------------------------------

  // Cuadrante Superior Derecho (55-51)
  { id: 55, posX: 150, posY: 120, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 54, posX: 200, posY: 120, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 53, posX: 250, posY: 120, tipo: 'canino', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 52, posX: 300, posY: 120, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 51, posX: 350, posY: 120, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },

  // Cuadrante Superior Izquierdo (61-65)
  { id: 61, posX: 455, posY: 120, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 62, posX: 500, posY: 120, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 63, posX: 550, posY: 120, tipo: 'canino', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 64, posX: 600, posY: 120, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 65, posX: 650, posY: 120, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },

  // Cuadrante Inferior Derecho (85-81)
  { id: 85, posX: 150, posY: 480, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 84, posX: 200, posY: 480, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 83, posX: 250, posY: 480, tipo: 'canino', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 82, posX: 300, posY: 480, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 81, posX: 350, posY: 480, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },

  // Cuadrante Inferior Izquierdo (71-75)
  { id: 71, posX: 450, posY: 480, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 72, posX: 500, posY: 480, tipo: 'molar', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 73, posX: 550, posY: 480, tipo: 'canino', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 74, posX: 600, posY: 480, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
  { id: 75, posX: 650, posY: 480, tipo: 'incisivo', tipoDentadura: 'temporal', estado: {}, intervenciones: [], historial: [] },
];

// Configuración de tipos de dientes (mantener para compatibilidad)
export const TOOTH_TYPES = {
  // Dientes adicionales (1-10)
  1: 'molar', 2: 'molar', 3: 'molar', 4: 'premolar', 5: 'premolar',
  6: 'canino', 7: 'incisivo', 8: 'incisivo', 9: 'incisivo', 10: 'incisivo',
  // Superior Derecho (11-18)
  11: 'incisivo', 12: 'incisivo', 13: 'canino', 14: 'premolar', 15: 'premolar',
  16: 'molar', 17: 'molar', 18: 'molar',
  // Superior Izquierdo (21-28)
  21: 'incisivo', 22: 'incisivo', 23: 'canino', 24: 'premolar', 25: 'premolar',
  26: 'molar', 27: 'molar', 28: 'molar',
  // Dientes adicionales (29-30)
  29: 'molar', 30: 'molar',
  // Inferior Izquierdo (31-38)
  31: 'molar', 32: 'molar', 33: 'molar', 34: 'premolar', 35: 'premolar',
  36: 'canino', 37: 'incisivo', 38: 'incisivo',
  // Inferior Derecho (41-48)
  41: 'incisivo', 42: 'incisivo', 43: 'canino', 44: 'premolar', 45: 'premolar',
  46: 'molar', 47: 'molar', 48: 'molar',
  // Temporales (51-85)
  51: 'incisivo', 52: 'incisivo', 53: 'canino', 54: 'molar', 55: 'molar',
  61: 'incisivo', 62: 'incisivo', 63: 'canino', 64: 'molar', 65: 'molar',
  71: 'molar', 72: 'molar', 73: 'canino', 74: 'incisivo', 75: 'incisivo',
  81: 'molar', 82: 'molar', 83: 'canino', 84: 'incisivo', 85: 'incisivo'
} as const;

// Función para obtener la posición de un diente desde la configuración completa
export const getToothPosition = (number: number): { posX: number; posY: number } => {
  const diente = TODOS_LOS_DIENTES.find(d => d.id === number);
  if (diente) {
    return { posX: diente.posX, posY: diente.posY };
  }
  return { posX: 0, posY: 0 };
};

// Función para obtener el tipo de diente
export const getToothType = (number: number): 'incisivo' | 'canino' | 'premolar' | 'molar' => {
  const diente = TODOS_LOS_DIENTES.find(d => d.id === number);
  if (diente) {
    return diente.tipo as 'incisivo' | 'canino' | 'premolar' | 'molar';
  }
  return 'incisivo';
};

// Función para obtener el cuadrante de un diente
export const getToothCuadrante = (number: number): 'superior-derecho' | 'superior-izquierdo' | 'inferior-derecho' | 'inferior-izquierdo' => {
  // Dientes adicionales (1-10) - considerados como superior-derecho
  if (number >= 1 && number <= 10) return 'superior-derecho';
  if (number >= 11 && number <= 18) return 'superior-derecho';
  if (number >= 21 && number <= 28) return 'superior-izquierdo';
  // Dientes adicionales (29-30) - considerados como superior-izquierdo
  if (number >= 29 && number <= 30) return 'superior-izquierdo';
  if (number >= 41 && number <= 48) return 'inferior-derecho';
  if (number >= 31 && number <= 38) return 'inferior-izquierdo';
  // Temporales
  if (number >= 51 && number <= 55) return 'superior-derecho';
  if (number >= 61 && number <= 65) return 'superior-izquierdo';
  if (number >= 81 && number <= 85) return 'inferior-derecho';
  if (number >= 71 && number <= 75) return 'inferior-izquierdo';
  return 'superior-derecho';
};

// Función para determinar si es dentadura permanente o temporal
export const getTipoDentadura = (number: number): 'permanente' | 'temporal' => {
  const diente = TODOS_LOS_DIENTES.find(d => d.id === number);
  if (diente) {
    return diente.tipoDentadura as 'permanente' | 'temporal';
  }
  return 'permanente';
};

// Función para filtrar dientes por tipo de dentadura
export const getTeethByType = (tipoDentadura: 'permanente' | 'temporal'): typeof TODOS_LOS_DIENTES => {
  return TODOS_LOS_DIENTES.filter(diente => diente.tipoDentadura === tipoDentadura);
};

// Función para calcular el ángulo de rotación de un diente basado en su posición en la arcada
export const getToothRotation = (number: number): number => {
  const cuadrante = getToothCuadrante(number);
  const position = getToothPosition(number);
  
  // Centro de la arcada (aproximadamente en el centro del odontograma)
  const centerX = 410; // Centro aproximado del odontograma
  
  // Calcular el ángulo basado en la posición horizontal relativa al centro
  const relativeX = position.posX - centerX;
  
  // Mapear la posición relativa a un ángulo de rotación
  // Los dientes más alejados del centro tendrán más rotación
  let rotation = 0;
  
  if (cuadrante === 'superior-derecho' || cuadrante === 'superior-izquierdo') {
    // Arcada superior - rotación más agresiva
    if (Math.abs(relativeX) < 30) {
      rotation = 0; // Dientes centrales sin rotación
    } else if (Math.abs(relativeX) < 100) {
      rotation = relativeX > 0 ? 25 : -25; // Rotación moderada
    } else if (Math.abs(relativeX) < 200) {
      rotation = relativeX > 0 ? 40 : -40; // Rotación más pronunciada
    } else {
      rotation = relativeX > 0 ? 55 : -55; // Rotación máxima
    }
  } else {
    // Arcada inferior - rotación inversa más agresiva
    if (Math.abs(relativeX) < 30) {
      rotation = 0; // Dientes centrales sin rotación
    } else if (Math.abs(relativeX) < 100) {
      rotation = relativeX > 0 ? -25 : 25; // Rotación moderada inversa
    } else if (Math.abs(relativeX) < 200) {
      rotation = relativeX > 0 ? -40 : 40; // Rotación más pronunciada inversa
    } else {
      rotation = relativeX > 0 ? -55 : 55; // Rotación máxima inversa
    }
  }
  
  return rotation;
}; 